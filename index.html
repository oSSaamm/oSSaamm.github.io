<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extract Video Frames</title>
</head>
<body>
    <h1>Upload Video and Extract Frames</h1>
    <input type="file" id="videoInput" accept="video/*">
    <button onclick="extractFrames()">Extract Frames</button>
    <button id="downloadButton" onclick="downloadFrames()" disabled>Download All Frames</button>
    <div id="framesContainer"></div>
    
    <script>
        let frames = [];
        let downloadButton = document.getElementById("downloadButton");
        let framesContainer = document.getElementById("framesContainer");
        
        function extractFrames() {
            let video = document.createElement("video");
            let file = document.getElementById("videoInput").files[0];
            let canvas = document.createElement("canvas");
            let ctx = canvas.getContext("2d");
            frames = [];
            framesContainer.innerHTML = "";
            downloadButton.disabled = true;
            
            if (!file) return alert("Please select a video first!");
            
            let url = URL.createObjectURL(file);
            video.src = url;
            video.crossOrigin = "anonymous";
            video.play();
            
            video.addEventListener("loadeddata", () => {
                let fps = 30;
                let frameRate = 1 / fps;
                let currentTime = 0;
                let frameCount = 0;
                
                function captureFramesForSecond(second) {
                    let frameIndex = 0;
                    
                    function captureFrame() {
                        if (frameIndex >= fps || second >= Math.floor(video.duration)) {
                            if (second < Math.floor(video.duration)) {
                                captureFramesForSecond(second + 1);
                            } else {
                                downloadButton.disabled = false;
                            }
                            return;
                        }
                        
                        video.currentTime = second + (frameIndex * frameRate);
                        video.addEventListener("seeked", function processFrame() {
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                            let imgData = canvas.toDataURL("image/png");
                            let frameName = `frame_${second}_${frameIndex}.png`;
                            frames.push({ imgData, name: frameName });
                            
                            let imgElement = document.createElement("img");
                            imgElement.src = imgData;
                            imgElement.alt = frameName;
                            imgElement.style.width = "200px";
                            imgElement.style.margin = "5px";
                            framesContainer.appendChild(imgElement);
                            
                            frameIndex++;
                            video.removeEventListener("seeked", processFrame);
                            captureFrame();
                        });
                    }
                    
                    captureFrame();
                }
                
                captureFramesForSecond(0);
            });
        }
        
        function downloadFrames() {
            frames.forEach((frame) => {
                let a = document.createElement("a");
                a.href = frame.imgData;
                a.download = frame.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
        }
    </script>
</body>
</html>
